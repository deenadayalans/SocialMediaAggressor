<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Social Media Aggregator</title>
    <link rel="stylesheet" href="/static/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <script>
        // Toggle between Social Feeds and News Feeds
        function toggleFeeds(view) {
            const socialFeeds = document.getElementById("socialFeeds");
            const newsFeeds = document.getElementById("newsFeeds");

            if (view === "social") {
                socialFeeds.style.display = "block";
                newsFeeds.style.display = "none";
            } else {
                socialFeeds.style.display = "none";
                newsFeeds.style.display = "block";
            }
        }

        // Set the default view to Social Feeds on page load
        window.addEventListener("load", () => {
            toggleFeeds("social");
        });

        // Handle search form submission
        function handleSearch(event) {
            const searchButton = document.getElementById("searchButton");
            const loadingIndicator = document.getElementById("loadingIndicator");

            searchButton.disabled = true;
            loadingIndicator.style.display = "inline-block";
        }

        // Handle previously searched keywords
        function handleKeywordClick(event) {
            const loadingIndicator = document.getElementById("loadingIndicator");
            loadingIndicator.style.display = "inline-block";

            const keywordButtons = document.querySelectorAll(".keyword-block");
            keywordButtons.forEach(button => button.disabled = true);
        }

        // Load more news dynamically
        let currentPage = 1;
        function loadMoreNews(keyword) {
            currentPage++;
            const loadMoreButton = document.getElementById("loadMoreNews");
            const loadingIndicator = document.getElementById("newsLoadingIndicator");

            loadMoreButton.disabled = true;
            loadingIndicator.style.display = "inline-block";

            fetch(`/news?keyword=${encodeURIComponent(keyword)}&page=${currentPage}`)
                .then(response => response.json())
                .then(data => {
                    const newsContainer = document.getElementById("news-results");
                    data.results.forEach(result => {
                        const newsItem = document.createElement("li");
                        newsItem.innerHTML = `
                            <div class="result-item">
                                <img src="${result.thumbnail || '/static/default-thumbnail.png'}" alt="News Thumbnail" class="thumbnail">
                                <div class="result-content">
                                    <h3><a href="${result.link}" target="_blank">${result.title}</a></h3>
                                    <p>${result.description}</p>
                                    <div class="meta">
                                        <span class="source">${result.source}</span>
                                        <span class="date">${result.published}</span>
                                    </div>
                                </div>
                            </div>
                        `;
                        newsContainer.appendChild(newsItem);
                    });

                    loadMoreButton.disabled = false;
                    loadingIndicator.style.display = "none";
                });
        }

        // Dark mode toggle
        window.addEventListener("load", () => {
            const darkModeToggle = document.getElementById("darkModeToggle");
            const body = document.body;

            if (localStorage.getItem("darkMode") === "true") {
                body.classList.add("dark-mode");
                darkModeToggle.textContent = "ðŸŒž"; 
            }

            darkModeToggle.addEventListener("click", () => {
                body.classList.toggle("dark-mode");
                const isDarkMode = body.classList.contains("dark-mode");

                localStorage.setItem("darkMode", isDarkMode);
                darkModeToggle.textContent = isDarkMode ? "ðŸŒž" : "ðŸŒ™";
            });
        });

        // Scroll to top functionality
        function scrollToTop() {
            window.scrollTo({ top: 0, behavior: "smooth" });
        }

        window.addEventListener("scroll", () => {
            const backToTopButton = document.getElementById("backToTop");
            backToTopButton.style.display = window.scrollY > 300 ? "block" : "none";
        });
    </script>
</head>
<body>
    <div class="container">
        <h1>Social Media Aggregator</h1>

        <!-- Toggle Buttons -->
        <div class="toggle-buttons">
            <button onclick="toggleFeeds('social')" id="socialToggle">Social Feeds</button>
            <button onclick="toggleFeeds('news')" id="newsToggle">News Feeds</button>
        </div>

        <!-- Search Form -->
        <form method="POST" action="/search" id="searchForm" class="search-form" onsubmit="handleSearch(event)">
            <input type="text" name="keyword" placeholder="Enter keyword..." value="{{.keyword}}" required>
            <button type="submit" id="searchButton">
                <i class="fas fa-search"></i> Search
            </button>
            <button id="darkModeToggle" class="dark-mode-toggle">ðŸŒ™</button>
            <img id="loadingIndicator" src="/static/loading.gif" alt="Loading..." style="display: none; width: 20px; height: 20px; margin-left: 10px;">
        </form>

        <!-- Previously Searched Keywords -->
        {{ if .searchedKeywords }}
        <div class="searched-keywords">
            <p>Previously searched:</p>
            <div class="keywords-container" id="keywordsContainer">
                {{ range .searchedKeywords }}
                <form method="POST" action="/search" style="display: inline;">
                    <input type="hidden" name="keyword" value="{{ . }}">
                    <button type="submit" class="keyword-block" onclick="handleKeywordClick(event)">{{ . }}</button>
                </form>
                {{ end }}
            </div>
        </div>
        <script>
            // Limit keywords to fit within one line
            function limitKeywordsToOneLine() {
                const container = document.getElementById("keywordsContainer");
                const keywords = Array.from(container.children);
                let totalWidth = 0;

                // Reset visibility for all keywords
                keywords.forEach(keyword => {
                    keyword.style.display = "inline-block";
                });

                // Calculate total width and hide overflowing keywords
                keywords.forEach(keyword => {
                    totalWidth += keyword.offsetWidth + 10; // Add gap between keywords
                    if (totalWidth > container.offsetWidth) {
                        keyword.style.display = "none"; // Hide overflowing keywords
                    } else {
                        keyword.style.display = "inline-block"; // Ensure fully visible
                    }
                });
            }

            // Run the function on page load and window resize
            window.addEventListener("load", limitKeywordsToOneLine);
            window.addEventListener("resize", limitKeywordsToOneLine);
        </script>
        {{ end }}

        <!-- Social Feeds Section -->
        <div id="socialFeeds" style="display: none;">
            <h2>Social Feeds</h2>
            <div class="panes-container">
                <!-- Twitter Pane -->
                <div class="pane twitter-pane">
                    <h2><i class="fab fa-twitter"></i> Twitter</h2>
                    <div class="content">
                        {{ if .results.Twitter }}
                        <ul>
                            {{ range .results.Twitter }}
                            <li>
                                <div class="result-item">
                                    <h3><a href="{{ .Link }}" target="_blank">{{ .Title }}</a></h3>
                                    <p>{{ .Description }}</p>
                                    <span class="meta">{{ .Published }}</span>
                                </div>
                            </li>
                            {{ end }}
                        </ul>
                        {{ else }}
                        <div class="no-results">
                            <img src="/static/no-results-placeholder.png" alt="No Results" class="no-results-image">
                            <p>No results found for this platform</p>
                        </div>
                        {{ end }}
                    </div>
                    <div id="twitterLoadingIndicator" style="display: none;">Loading Twitter results...</div>
                </div>

                <!-- Facebook Pane -->
                <div class="pane facebook-pane">
                    <h2><i class="fab fa-facebook"></i> Facebook</h2>
                    <div class="content">
                        {{ if .results.Facebook }}
                        <ul>
                            {{ range .results.Facebook }}
                            <li>
                                <div class="result-item">
                                    <img src="https://via.placeholder.com/100" alt="Facebook Icon" class="thumbnail">
                                    <div class="result-content">
                                        <h3><a href="{{ .Link }}" target="_blank">{{ .Title }}</a></h3>
                                        <p>{{ .Description }}</p>
                                        <span class="meta">{{ .Published }}</span>
                                    </div>
                                </div>
                            </li>
                            {{ end }}
                        </ul>
                        {{ else }}
                        <div class="no-results">
                            <img src="/static/no-results-placeholder.png" alt="No Results" class="no-results-image">
                            <p>No results found for this platform</p>
                        </div>
                        {{ end }}
                    </div>
                    <div id="facebookLoadingIndicator" style="display: none;">Loading Facebook results...</div>
                </div>

                <!-- Instagram Pane -->
                <div class="pane instagram-pane">
                    <h2><i class="fab fa-instagram"></i> Instagram</h2>
                    <div class="content">
                        {{ if .results.Instagram }}
                        <ul>
                            {{ range .results.Instagram }}
                            <li>
                                <div class="result-item">
                                    <img src="https://via.placeholder.com/100" alt="Instagram Icon" class="thumbnail">
                                    <div class="result-content">
                                        <h3><a href="{{ .Link }}" target="_blank">{{ .Title }}</a></h3>
                                        <p>{{ .Description }}</p>
                                        <span class="meta">{{ .Published }}</span>
                                    </div>
                                </div>
                            </li>
                            {{ end }}
                        </ul>
                        {{ else }}
                        <div class="no-results">
                            <img src="/static/no-results-placeholder.png" alt="No Results" class="no-results-image">
                            <p>No results found for this platform</p>
                        </div>
                        {{ end }}
                    </div>
                </div>

                <!-- YouTube Pane -->
                <div class="pane youtube-pane">
                    <h2><i class="fab fa-youtube"></i> YouTube</h2>
                    <div class="content">
                        {{ if .results.YouTube }}
                        <ul>
                            {{ range .results.YouTube }}
                            <li>
                                <div class="result-item">
                                    <img src="{{ if .Thumbnail }}{{ .Thumbnail }}{{ else }}/static/default-thumbnail.png{{ end }}" alt="Thumbnail" class="thumbnail">
                                    <div class="result-content">
                                        <h3><a href="{{ .Link }}" target="_blank">{{ .Title }}</a></h3>
                                        <p>{{ .Description }}</p>
                                        <span class="meta">{{ .Published }}</span>
                                    </div>
                                </div>
                            </li>
                            {{ end }}
                        </ul>
                        {{ else }}
                        <div class="no-results">
                            <img src="/static/no-results-placeholder.png" alt="No Results" class="no-results-image">
                            <p>No results found for this platform</p>
                        </div>
                        {{ end }}
                    </div>
                    <div id="youtubeLoadingIndicator" style="display: none;">Loading YouTube results...</div>
                </div>
            </div>
        </div>

        <!-- News Feeds Section -->
        <div id="newsFeeds" style="display: none;">
            <h2>News Feeds</h2>
            <div class="content">
                {{ if .results.News }}
                <ul id="news-results">
                    {{ range .results.News }}
                    <li>
                        <div class="result-item">
                            <img src="{{ if .Thumbnail }}{{ .Thumbnail }}{{ else }}/static/default-thumbnail.png{{ end }}" alt="Thumbnail" class="thumbnail">
                            <div class="result-content">
                                <h3><a href="{{ .Link }}" target="_blank">{{ .Title }}</a></h3>
                                <p>{{ .Description }}</p>
                                <div class="meta">
                                    <span class="source">{{ .Source }}</span>
                                    <span class="date">{{ .Published }}</span>
                                </div>
                            </div>
                        </div>
                    </li>
                    {{ end }}
                </ul>
                <button id="loadMoreNews" onclick="loadMoreNews('{{ .keyword }}')">Load More</button>
                <img id="newsLoadingIndicator" src="/static/loading.gif" alt="Loading..." style="display: none; width: 20px; height: 20px; margin-left: 10px;">
                {{ else }}
                <div class="no-results">
                    <p>No news feeds available. Try searching for something else!</p>
                </div>
                {{ end }}
            </div>
        </div>
        {{ if not .results }}
        <div class="no-results-placeholder">
            <p>No results found. Try searching for something else!</p>
            <img src="/static/no-results.png" alt="No Results" class="no-results-image">
        </div>
        {{ end }}
        <button id="backToTop" onclick="scrollToTop()">â¬† Back to Top</button>
    </div>
    <script>
        function scrollToTop() {
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        // Show or hide the "Back to Top" button
        window.addEventListener("scroll", () => {
            const backToTopButton = document.getElementById("backToTop");
            if (window.scrollY > 300) {
                backToTopButton.style.display = "block";
            } else {
                backToTopButton.style.display = "none";
            }
        });
    </script>
</body>
</html>